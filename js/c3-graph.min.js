(function(){var i={}.hasOwnProperty,t=function(n,t){function u(){this.constructor=n}for(var r in t)i.call(t,r)&&(n[r]=t[r]);return u.prototype=t.prototype,n.prototype=new u,n.__super__=t.prototype,n},n=function(n,t){return function(){return n.apply(t,arguments)}},r=[].indexOf||function(n){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===n)return t;return-1};c3.Graph=function(n){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,n),i.version=.1,i.prototype.type="graph",i}(c3.Chart);c3.Sankey=function(i){function u(){return this._style=n(this._style,this),this._draw=n(this._draw,this),this._layout=n(this._layout,this),this._update=n(this._update,this),this._size=n(this._size,this),this._init=n(this._init,this),u.__super__.constructor.apply(this,arguments)}return t(u,i),u.version=.1,u.prototype.type="sankey",u.prototype.data=[],u.prototype.links=[],u.prototype.key=void 0,u.prototype.value=void 0,u.prototype.link_source=void 0,u.prototype.link_target=void 0,u.prototype.link_value=void 0,u.prototype.iterations=32,u.prototype.alpha=.99,u.prototype.node_padding="20%",u.prototype.node_width=30,u.prototype.align="both",u.prototype.link_path="curve",u.prototype.link_path_curvature=.5,u.prototype.nodes_options=void 0,u.prototype.node_options=void 0,u.prototype.rect_options=void 0,u.prototype.links_options=void 0,u.prototype.link_options=void 0,u.prototype.path_options=void 0,u.prototype.node_label_options=void 0,u.prototype.link_label_options=void 0,u.prototype._init=function(){return this.h=d3.scale.linear(),this.v=d3.scale.linear(),this.key==null&&(this.key=function(n){return function(t){return n.data.indexOf(t)}}(this)),this.link_key==null&&(this.link_key=function(n){return function(t){return n.link_source(t)+","+n.link_target(t)}}(this)),this.link_source==null&&(this.link_source=function(n){return n.source}),this.link_target==null&&(this.link_target=function(n){return n.target}),this.link_value!=null?this.link_value:this.link_value=function(n){return n.value}},u.prototype._size=function(){return this.v.range([0,this.height]),isNaN(this.node_padding)?void 0:this._update()},u.prototype._update=function(n){var s,k,e,et,f,i,h,ot,d,t,o,u,l,a,g,v,c,y,p,w,b,st,ht,ct,lt,nt,tt,it,rt,ut,ft;if(n!=="render"||isNaN(this.node_padding)){for(this.nodes=u={},this.node_links=o={},k=[],it=this.links,y=0,st=it.length;y<st;y++)if(i=it[y],h=this.link_key(i),ot=this.link_value(i),ot){if(o[h]!=null)throw Error("Link with duplicate source and target specified");k.push(i);o[h]={value:this.link_value(i)};t=u[nt=this.link_source(i)]!=null?u[nt]:u[nt]={source_links:[],target_links:[]};t.target_links.push(i);t=u[tt=this.link_target(i)]!=null?u[tt]:u[tt]={source_links:[],target_links:[]};t.source_links.push(i)}if(s=function(){var n,r,t,i;for(t=this.data,i=[],n=0,r=t.length;n<r;n++)e=t[n],this.key(e)in this.nodes&&i.push(e);return i}.call(this),this.value!=null)for(p=0,ht=s.length;p<ht;p++)e=s[p],u[this.key(e)].value=this.value(e);else for(f=this.key,h=this.link_key,w=0,ct=s.length;w<ct;w++)e=s[w],t=u[f(e)],t.value=Math.max(d3.sum(t.source_links,function(n){return o[h(n)].value}),d3.sum(t.target_links,function(n){return o[h(n)].value}));for(f in u)if(t=u[f],t.value==null)throw Error("Missing nodes are not currently supported");v={};rt=this.nodes;for(f in rt)(t=rt[f],v[f])||(a=[],(et=function(n){return function(t,f){var h,e,s,l,c;for(v[t]=!0,a.push(f),c=f.target_links,s=0,l=c.length;s<l;s++)i=c[s],e=n.link_target(i),h=u[e],o[n.link_key(i)].backedge=r.call(a,h)>=0,v[e]||et(e,h);return a.pop()}}(this))(f,t));for(l=this.nodes,c=0;!c3.util.isEmpty(l);){d={};for(f in l)for(t=l[f],t.x=c,ut=t.target_links,b=0,lt=ut.length;b<lt;b++)(i=ut[b],o[this.link_key(i)].backedge)||(g=this.link_target(i),d[g]=u[g]);l=d;c++}if(c--,this.align==="both"){ft=this.nodes;for(f in ft)t=ft[f],t.target_links.length||(t.x=c)}return this.h.domain([0,c]),this._layout(n,s,k)}},u.prototype._layout=function(n,t,i){var ft,et,u,f,h,o,gt,a,v,ot,s,ni,r,e,st,y,ti,ht,ii,ct,lt,p,ri,w,b,k,at,ui,fi,ei,oi,si,hi,ci,li,ai,vi,yi,pi,d,vt,g,nt,c,tt,yt,pt,wt,l,bt,kt,dt,it,rt,ut;if(y=this.nodes,st=this.node_links,this.columns=f=d3.nest().key(function(n){return n.x}).sortKeys(d3.ascending).entries(function(){var n,t;n=this.nodes;t=[];for(v in n)r=n[v],t.push(r);return t}.call(this)).map(function(n){return n.values}),c3.array.sort_up(this.columns,function(n){return n[0].x}),isNaN(this.node_padding))if((typeof(ri=this.node_padding).charAt=="function"?ri.charAt(this.node_padding.length-1):void 0)==="%")for(b=0,fi=f.length;b<fi;b++)u=f[b],u.padding_percent=u.length===1?0:this.node_padding.slice(0,-1)/100,u.padding_percent===1&&(u.padding_percent=.999);else throw new Error("Unsupported node_padding parameter: "+this.node_padding);else for(w=0,ui=f.length;w<ui;w++)u=f[w],u.padding_percent=this.node_padding*(u.length-1)/this.height,u.padding_percent>.8&&(u.padding_percent=.8);for(ct=d3.max(function(){var n,i,t;for(t=[],n=0,i=f.length;n<i;n++)u=f[n],t.push(d3.sum(u,function(n){return n.value})/(1-u.padding_percent));return t}()),this.v.domain([0,ct]),k=0,si=f.length;k<si;k++)u=f[k],u.padding=u.length===1?0:ct*u.padding_percent/(u.length-1);if(et=function(n){return function(){var t,i,e,h,c,o,s;for(s=[],e=0,h=f.length;e<h;e++){for(u=f[e],c3.array.sort_up(u,function(n){return n.y}),i=0,o=0,c=u.length;o<c;o++)r=u[o],t=i-r.y,t>0&&(r.y+=t),i=r.y+r.value+u.padding;r.y+r.value>n.v.domain()[1]?(i=n.v.domain()[1],s.push(function(){for(var f=[],n=u.length-1;n>=0;n+=-1){if(r=u[n],t=r.y+r.value-i,t>0)r.y-=t;else break;f.push(i=r.y-u.padding)}return f}())):s.push(void 0)}return s}}(this),ot=function(n){return function(){var a,f,s,v,p,i,u,e,w,b,o,h,c,l;for(s=n.link_key,v=n.link_source,p=n.link_target,h=function(){var r,n,i;for(i=[],n=0,r=t.length;n<r;n++)a=t[n],i.push(this.nodes[this.key(a)]);return i}.call(n),l=[],e=0,w=h.length;e<w;e++){for(r=h[e],c3.array.sort_up(r.source_links,function(n){return y[v(n)].y}),u=r.y,c=r.source_links,o=0,b=c.length;o<b;o++)f=c[o],i=st[s(f)],i.ty=u,u+=i.value;c3.array.sort_up(r.target_links,function(n){return y[p(n)].y});u=r.y;l.push(function(){var o,n,t,e;for(t=r.target_links,e=[],n=0,o=t.length;n<o;n++)f=t[n],i=st[s(f)],i.sy=u,e.push(u+=i.value);return e}())}return l}}(this),p=0,f.length){for(c3.array.sort_up(f[0],function(n){return n.value}),ii=f[0].slice(0),yt=d3.merge([function(){var n,i,t;for(t=[],o=n=i=f[0].length-1;n>=0;o=n+=-2)t.push(o);return t}(),function(){var n,r,i,t;for(t=[],o=n=r=f[0].length%2,i=f[0].length-1;n<=i;o=n+=2)t.push(o);return t}()]),o=at=0,hi=yt.length;at<hi;o=++at)ti=yt[o],f[0][o]=ii[ti];for(pt=f[0],d=0,ci=pt.length;d<ci;d++)if(r=pt[d],r.y=p,p+=r.value+u.padding,isNaN(p))throw"BLARG";}for(a=vt=0,li=f.length;vt<li;a=++vt)if(u=f[a],a)for(g=0,ai=u.length;g<ai;g++){for(r=u[g],lt=0,ht=0,wt=r.source_links,nt=0,vi=wt.length;nt<vi;nt++)(s=wt[nt],ni=this.link_key(s),e=this.node_links[ni],e.backedge)||(lt+=y[this.link_source(s)].y*e.value,ht+=e.value);r.y=lt/ht}for(et(),ot(),ft=1,gt=c=0,l=this.iterations;0<=l?c<l:c>l;gt=0<=l?++c:--c){ft*=this.alpha;bt=this.nodes;for(v in bt)r=bt[v],r.links_sum=d3.sum(r.source_links,function(n){return function(t){return n.node_links[n.link_key(t)].value}}(this))+d3.sum(r.target_links,function(n){return function(t){return n.node_links[n.link_key(t)].value}}(this));for(tt=0,yi=f.length;tt<yi;tt++)for(u=f[tt],it=0,pi=u.length;it<pi;it++){for(r=u[it],h=0,kt=r.source_links,rt=0,ei=kt.length;rt<ei;rt++)s=kt[rt],e=this.node_links[this.link_key(s)],e.backedge||(h+=(e.sy-e.ty)*e.value);for(dt=r.target_links,ut=0,oi=dt.length;ut<oi;ut++)s=dt[ut],e=this.node_links[this.link_key(s)],e.backedge||(h+=(e.ty-e.sy)*e.value);h/=r.links_sum;r.y+=h*ft}et();ot()}return this.nodes_layer=this.content.select("g.nodes").singleton().options(this.nodes_options).update(),this.node_g=this.nodes_layer.select("g.node").options(this.node_options).animate(n!=="render").bind(t,this.key).update(),this.rects=this.node_g.inherit("rect").options(this.rect_options).update(),this.links_layer=this.content.select("g.links",":first-child").singleton().options(this.links_options).update(),this.link_g=this.links_layer.select("g.link").options(this.link_options).animate(n!=="render").bind(i,this.link_key).update(),this.paths=this.link_g.inherit("path").options(this.path_options).update(),this.link_g.all.classed("backedge",function(n){return function(t){return n.node_links[n.link_key(t)].backedge}}(this))},u.prototype._draw=function(n){var i,t,r;if(isNaN(this.node_width))if((typeof(r=this.node_width).charAt=="function"?r.charAt(this.node_width.length-1):void 0)==="%")i=this.node_width.slice(0,-1)/100,t=i*this.width/(this.columns.length+i-1);else throw new Error("Unsupported node_width parameter: "+this.node_width);else t=this.node_width;return this.h.rangeRound([0,this.width-t]),this.rects.animate(n!=="render"&&n!=="resize").position({x:function(n){return function(t){return n.h(n.nodes[n.key(t)].x)}}(this),y:function(n){return function(t){return n.v(n.nodes[n.key(t)].y)}}(this),width:t,height:function(n){return function(t){return Math.max(1,n.v(n.nodes[n.key(t)].value))}}(this)}),this.paths.animate(n!=="render"&&n!=="resize").position({d:function(n){return function(i){var s,r,c,u,f,l,e,o,h;r=n.node_links[n.link_key(i)];c=n.nodes[n.link_source(i)];l=n.nodes[n.link_target(i)];u=n.h(c.x)+t;e=n.h(l.x);switch(n.link_path){case"straight":return f=n.v(r.sy),o=n.v(r.ty),"M"+u+","+f+"L"+e+","+o+"l0,"+n.v(r.value)+"L"+u+","+(f+n.v(r.value))+"Z";case"curve":return s=e>u?n.link_path_curvature:-n.link_path_curvature*4,f=n.v(r.sy+r.value/2),o=n.v(r.ty+r.value/2),h=d3.interpolateRound(u,e),"M"+u+","+f+"C"+h(s)+","+f+" "+h(1-s)+","+o+" "+e+","+o;default:throw Error("Unknown link_path option: "+n.link_path);}}}(this),"stroke-width":this.link_path==="curve"?function(n){return function(t){return Math.max(1,n.v(n.node_links[n.link_key(t)].value))}}(this):void 0}),this.links_layer.all.attr("class","links "+this.link_path)},u.prototype._style=function(n){return this.node_g.options(this.node_options),this.rects.options(this.rect_options),this.link_g.options(this.link_options),this.paths.options(this.path_options),this.nodes_layer.style(),this.node_g.style(n),this.rects.style(n),this.links_layer.style(),this.link_g.style(n),this.paths.style(n)},u}(c3.Graph);c3.Butterfly=function(i){function r(){return this.focus=n(this.focus,this),this._style=n(this._style,this),this._butterfly_update=n(this._butterfly_update,this),this._update=n(this._update,this),r.__super__.constructor.apply(this,arguments)}return t(r,i),r.version=.1,r.prototype.type="butterfly",r.prototype.navigatable=!0,r.prototype.depth_of_field=2,r.prototype._update=function(){return r.__super__._update.apply(this,arguments),this._butterfly_update()},r.prototype._butterfly_update=function(){if(this.navigatable)return this.rects["new"].on("click",function(n){return function(t){return n.focus(t)}}(this))},r.prototype._style=function(){return r.__super__._style.apply(this,arguments),this.content.all.classed("navigatable",this.navigatable)},r.prototype.focus=function(n){var e,u,f,t,o,i,r;return console.debug(n),t=this.key(n),o=this.nodes[t],i={},i[t]=o,u=[],r=function(n){return function(t,f,e){var s,a,o,h,c,l,w,b,k,v,y,p;for(o=i[t]=n.nodes[t],o.x=n.depth_of_field+e*f,v=[o.source_links,o.target_links],h=0,w=v.length;h<w;h++)for(a=v[h],c=0,b=a.length;c<b;c++)s=a[c],u.push(s);if(e<n.depth_of_field){for(y=f===1?o.target_links:o.source_links,p=[],l=0,k=y.length;l<k;l++)s=y[l],p.push(r((f===1?n.link_target:n.link_source)(s),f,e+1));return p}}}(this),r(t,1,0),r(t,-1,0),e=function(){var n,u,t,r;for(t=this.data,r=[],n=0,u=t.length;n<u;n++)f=t[n],this.key(f)in i&&r.push(f);return r}.call(this),this.h.domain([0,this.depth_of_field*2]),this._layout("focus",e,u),this._butterfly_update(),this._draw("focus"),this._style(!0)},r}(c3.Sankey)}).call(this);